<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-2429LYJSNH"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-2429LYJSNH');
  </script>

  <meta charset="UTF-8">
  <title>I3E Economic Uncertainty Index | Global Economic Uncertainty Indicator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="description" content="The I3E Economic Uncertainty Index measures and compares economic uncertainty in major economies worldwide. Updated daily, unbiased and transparent.">
  <meta name="keywords" content="I3E, Economic Uncertainty, Uncertainty Index, Economic Risk, IESE, Economic Indicators, International Center for Decision Making, Global Economic Index, Research, Data">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://wdecisions.github.io/i3e/">

  <!-- âœ… Favicons (Fixed with Absolute URLs for Google) -->
  <link rel="icon" href="https://wdecisions.github.io/i3e/favicon.png?v=2" sizes="48x48" type="image/png">
  <link rel="icon" href="https://wdecisions.github.io/i3e/favicon.ico?v=2" sizes="any">
  <link rel="apple-touch-icon" href="https://wdecisions.github.io/i3e/favicon.png?v=2">
  <link rel="mask-icon" href="https://wdecisions.github.io/i3e/mask-icon.svg" color="#FF3B30">

  <!-- Open Graph / Facebook -->
  <meta property="og:title" content="I3E Economic Uncertainty Index">
  <meta property="og:description" content="Track economic uncertainty globally with the I3E Index. Daily updates, transparent methodology, downloadable data for researchers and decision-makers">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://wdecisions.github.io/i3e/">
  <meta property="og:image" content="https://wdecisions.github.io/i3e/plots/global_weighted.png">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="I3E Economic Uncertainty Index">
  <meta name="twitter:description" content="Explore global economic uncertainty with I3E's transparent and up-to-date index.">
  <meta name="twitter:image" content="https://wdecisions.github.io/i3e/plots/global_weighted.png">

  <!-- Schema.org Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "I3E Economic Uncertainty Index",
    "url": "https://wdecisions.github.io/i3e/",
    "logo": "https://wdecisions.github.io/i3e/favicon.png",
    "description": "The I3E Economic Uncertainty Index is an unbiased, daily-updated measure of global and national economic uncertainty, powered by IESE Business School and the International Center for Decision Making.",
    "publisher": {
      "@type": "Organization",
      "name": "IESE Business School",
      "url": "https://www.iese.edu"
    }
  }
  </script>

  <!-- Load Plotly and Custom Charts -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

  <!-- ðŸ”§ Shim: force responsive plots + immediate resize after newPlot -->
  <script>
    (function () {
      if (!window.Plotly) return;
      const _newPlot = Plotly.newPlot;
      Plotly.newPlot = function (root, data, layout, config) {
        const cfg = Object.assign({ responsive: true }, config || {});
        const lay = Object.assign({ autosize: true }, layout || {});
        return _newPlot(root, data, lay, cfg).then(function (gd) {
          try { Plotly.Plots.resize(gd); } catch (e) {}
          return gd;
        });
      };
    })();
  </script>

  <script src="charts.js"></script>

  <style>
    html, body { margin: 0; padding: 0; }
    body {
      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      background-color: #ffffff;
      display: flex;
    }
    .sidebar {
      width: 120px;
      flex-shrink: 0;
      background-color: #f4f4f4;
      padding: 0px 10px 10px 10px;
      height: 100vh;
      overflow-y: auto;
      border-right: 1px solid #ddd;
    }
    .sidebar h2 { font-size: 16px; margin-top: 0; margin-bottom: 8px; }
    .sidebar a {
      display: block;
      padding: 4px 8px;
      color: #333;
      text-decoration: none;
      margin-bottom: 2px;
      font-size: 14px;
    }
    .sidebar a:hover { background-color: #FF3B30; color: white; }

    .main {
      flex-grow: 1;
      max-width: 1700px;
      margin: 0 20px 20px 0;
      padding: 20px;
    }
    .header {
      background-color: #FF3B30;
      color: white;
      padding: 10px 20px;
      margin-left: 0.01px;
      box-sizing: border-box;
      max-width: 1500px;
    }
    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .header-top .title,
    .header-top .icdm { font-size: 16px; font-weight: bold; }
    .header-bottom {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
    }
    .nav a {
      display: inline-block;
      color: white;
      text-align: center;
      text-decoration: none;
      margin-right: 30px;
      font-size: 16px;
      line-height: 16px;
    }
    .business { font-size: 16px; line-height: 20px; }

    .content-wrapper {
      display: flex;
      flex-direction: row;
      align-items: flex-start;
      gap: 80px;
      margin-top: 20px;
    }
    .content {
      flex: 0 1 67%;
      text-align: justify;
      font-size: 13px;
    }
    .content p { font-size: 15px; }
    .content li { font-size: 15px; }

    #table-container,
    #table-subindex-container {
      min-width: 200px;
    }

    #table-container table,
    #table-subindex-container table {
      width: 100%;
      border-collapse: collapse;
      border: none;
      font-family: inherit;
      font-size: 14px;
      margin-bottom: 20px;
    }

    #table-container th,
    #table-container td,
    #table-subindex-container th,
    #table-subindex-container td {
      border-top: 1px solid #ddd;
      border-bottom: 1px solid #ddd;
      border-left: none;
      border-right: none;
      padding: 3px 8px;
      text-align: left;
      white-space: nowrap;
    }

    #table-container th,
    #table-subindex-container th {
      background-color: #FF3B30;
      color: white;
      font-weight: bold;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    h1 { color: #333333; font-size: 18px; }
    h2 { color: #333333; font-size: 16px; }
    p { line-height: 1.6; color: #444; }

    .plot-container {
      width: 100%;
      max-width: none;
      height: 60vh;
    }
    .plot-container > .js-plotly-plot,
    .plot-container .plotly,
    .plot-container svg {
      width: 100% !important;
      max-width: 100% !important;
    }

    @media (max-width: 1000px) {
      .content-wrapper { flex-direction: column; gap: 30px; }
      #table-container,
      #table-subindex-container {
        width: 100%;
        min-width: 0;
        margin: 0 auto;
        overflow-x: auto;
      }
      .content { width: 100%; max-width: 100%; }
    }

    @media (max-width: 768px) {
      body { flex-direction: column; }
      .sidebar {
        width: 100%;
        height: auto;
        border-right: none;
        border-bottom: 1px solid #ddd;
      }
      .main {
        margin: 0;
        padding: 0;
        max-width: none;
      }
      .header { max-width: none; margin-left: 0; box-sizing: border-box; }
      .plot-container {
        width: 100vw;
        margin-left: calc(50% - 50vw);
        margin-right: calc(50% - 50vw);
        height: 70vh;
      }
    }
  </style>
</head>

<body>
  <div class="sidebar">
    <img src="favicon_XL.png" alt="I3E Economic Uncertainty Index logo" style="display:block; margin:0 auto 18px auto; width:100%; height:auto; max-width:120px;">
    <h2>Countries</h2>
    <a href="#" data-country="global">Global</a>
    <a href="#" data-country="global_weighted">Global Weight</a>
    <a href="#" data-country="australia">Australia</a>
    <a href="#" data-country="austria">Austria</a>
    <a href="#" data-country="belgium">Belgium</a>
    <a href="#" data-country="brazil">Brazil</a>
    <a href="#" data-country="canada">Canada</a>
    <a href="#" data-country="china">China</a>
    <a href="#" data-country="egypt">Egypt</a>
    <a href="#" data-country="france">France</a>
    <a href="#" data-country="germany">Germany</a>
    <a href="#" data-country="greece">Greece</a>
    <a href="#" data-country="israel">Israel</a>
    <a href="#" data-country="italy">Italy</a>
    <a href="#" data-country="japan">Japan</a>
    <a href="#" data-country="mexico">Mexico</a>
    <a href="#" data-country="netherlands">Netherlands</a>
    <a href="#" data-country="poland">Poland</a>
    <a href="#" data-country="south_africa">South Africa</a>
    <a href="#" data-country="south_korea">South Korea</a>
    <a href="#" data-country="spain">Spain</a>
    <a href="#" data-country="turkey">Turkey</a>
    <a href="#" data-country="united_kingdom">United Kingdom</a>
    <a href="#" data-country="united_states">United States</a>
  </div>

  <div class="main">
    <div class="header">
      <div class="header-top">
        <div class="title">IESE I3E Economic Uncertainty Index</div>
        <div class="icdm">International Center for Decision Making (ICDM)</div>
      </div>
      <div class="header-bottom">
        <div class="nav">
          <a href="#">Home</a>
          <a href="#">Global Indices</a>
          <a href="#">Subindex</a>
          <a href="#">Data</a>
          <a href="#">Research</a>
          <a href="#">Contact</a>
        </div>
        <div class="business">IESE Business School</div>
      </div>
    </div>

    <div class="content-wrapper" id="content-wrapper">
      <div class="content" id="content">
        <h1>IESE I3E Economic Uncertainty Index</h1>
        <p>
          The <strong> IESE I3E Economic Uncertainty Index</strong> is a daily indicator of economic uncertainty across major world economies.
          Developed by IESE Business School and the International Center for Decision Making, the I3E Index combines stock market volatility, bond yields, exchange rates, and oil prices into a transparent and objective measure.
        </p>
        <p>
          The IESE I3E Economic Uncertainty Index offers a quantifiable and bias-free benchmark for comparing uncertainty levels across nations, providing insight for research and decision-making.
        </p>
        <p>The index is computed daily, using the variation rates of four key variables in each country:</p>
        <ul>
          <li>Domestic Stock Index</li>
          <li>Domestic 10-year government bond yields</li>
          <li>Domestic exchange rate</li>
          <li>International Brent crude oil prices</li>
        </ul>
        <p>
          The index has an average value of 100. Although it can vary across any range, in practice it fluctuates between 0 and 200.
          Values below 100 indicate uncertainty lower than the average of previous decades. Values above 100 indicate greater uncertainty.
        </p>
        <strong>Learn more:</strong>
        <p><a href="I3E.pdf" target="_blank">I3E Technical Note</a></p>
        <p><a href="I3E_and_alternatives.pdf" target="_blank">Comparison I3E, WUI, EPU, and WIX</a></p>
      </div>

      <div id="table-container"></div>
      <div id="table-subindex-container" style="display:none;"></div>
    </div>

    <!-- Chart containers -->
    <div id="chart-global" class="plot-container"></div>
    <div id="chart-global_weighted" class="plot-container" style="display:none;"></div>
    <div id="chart-australia" class="plot-container" style="display:none;"></div>
    <div id="chart-austria" class="plot-container" style="display:none;"></div>
    <div id="chart-belgium" class="plot-container" style="display:none;"></div>
    <div id="chart-brazil" class="plot-container" style="display:none;"></div>
    <div id="chart-canada" class="plot-container" style="display:none;"></div>
    <div id="chart-china" class="plot-container" style="display:none;"></div>
    <div id="chart-egypt" class="plot-container" style="display:none;"></div>
    <div id="chart-france" class="plot-container" style="display:none;"></div>
    <div id="chart-germany" class="plot-container" style="display:none;"></div>
    <div id="chart-greece" class="plot-container" style="display:none;"></div>
    <div id="chart-israel" class="plot-container" style="display:none;"></div>
    <div id="chart-italy" class="plot-container" style="display:none;"></div>
    <div id="chart-japan" class="plot-container" style="display:none;"></div>
    <div id="chart-mexico" class="plot-container" style="display:none;"></div>
    <div id="chart-netherlands" class="plot-container" style="display:none;"></div>
    <div id="chart-poland" class="plot-container" style="display:none;"></div>
    <div id="chart-south_africa" class="plot-container" style="display:none;"></div>
    <div id="chart-south_korea" class="plot-container" style="display:none;"></div>
    <div id="chart-spain" class="plot-container" style="display:none;"></div>
    <div id="chart-turkey" class="plot-container" style="display:none;"></div>
    <div id="chart-united_kingdom" class="plot-container" style="display:none;"></div>
    <div id="chart-united_states" class="plot-container" style="display:none;"></div>
  </div>

  <script>
    var time = "";
    var subindexTime = "";

    var contentWrapper = document.getElementById('content-wrapper');
    document.getElementById('table-container').style.display = 'block';
    document.getElementById('table-subindex-container').style.display = 'none';

    function showContentAndResetLayout() {
      const contentDiv = document.getElementById('content');
      contentDiv.style.display = 'block';
      contentWrapper.style.gap = '80px';
    }
    function hideContentForWideTable() {
      const contentDiv = document.getElementById('content');
      contentDiv.style.display = 'none';
      contentWrapper.style.gap = '0px';
    }

    function formatCountryName(name) {
      return name.replace(/_/g, ' ')
                 .replace(/\b\w/g, c => c.toUpperCase());
    }

    function isLikelyDateString(s) {
      // accept YYYY-MM-DD, YYYY/MM/DD, or YYYY-MM-DD HH:MM:SS
      if (!s) return false;
      const t = String(s).trim();
      return /^\d{4}[-\/]\d{2}[-\/]\d{2}(\s+\d{2}:\d{2}(:\d{2})?)?$/.test(t);
    }

    function parseTabFile(text) {
      // Returns { dates: [...], header: [...], rows: [[...], ...] } where header/rows exclude the time index column.
      const lines = String(text || "").trim().split('\n').filter(l => l.length > 0);
      if (lines.length < 2) return null;

      // split helper that preserves empty cells (important for leading tab)
      const splitRow = (line) => String(line).replace(/\r$/, '').split('\t');

      let rawHeader = splitRow(lines[0]).map(s => String(s || '').replace(/^\uFEFF/, '').trim());
      let rawData = lines.slice(1).map(splitRow);

      // Decide if first column is an index (date/time)
      // Typical pandas output: header[0] == "" and data[0][0] is a date.
      const headerFirst = (rawHeader[0] || "").trim().toLowerCase();
      const dataFirst = rawData[0] && rawData[0][0] ? String(rawData[0][0]).trim() : "";

      let hasIndexCol =
        headerFirst === "" ||
        headerFirst === "date" || headerFirst === "time" || headerFirst === "datetime" ||
        isLikelyDateString(dataFirst);

      // If hasIndexCol, drop first column from header AND from every data row.
      let header = rawHeader;
      let dates = rawData.map(r => (r && r[0] !== undefined) ? String(r[0]).trim() : "");

      if (hasIndexCol) {
        header = rawHeader.slice(1);
        rawData = rawData.map(r => r.slice(1));
      } else {
        // No index col: dates unknown; keep as empty
        dates = rawData.map(_ => "");
      }

      // Normalize row lengths (in case of trailing tabs)
      const targetLen = header.length;
      const rows = rawData.map(r => {
        const rr = r.slice(0, targetLen);
        while (rr.length < targetLen) rr.push("");
        return rr;
      });

      // Also normalize header length to targetLen (trim if extra)
      header = header.slice(0, targetLen);

      return { dates, header, rows };
    }

    function diffSpan(aStr, bStr, decimals) {
      let a = parseFloat(aStr), b = parseFloat(bStr);
      if (isNaN(a) || isNaN(b)) return "";
      let d = a - b;
      const k = (typeof decimals === "number") ? decimals : 1;
      return d >= 0 ? `<span style="color:red;">+${d.toFixed(k)}</span>` : `<span style="color:green;">${d.toFixed(k)}</span>`;
    }

    // Country blocks
    const countryBlocks = [
      ["united_states", "canada"],
      ["austria", "belgium", "france", "germany", "greece", "italy", "netherlands", "spain", "poland", "united_kingdom"],
      ["china", "japan", "south_korea", "australia"],
      ["brazil", "mexico"],
      ["israel", "turkey", "egypt", "south_africa"]
    ];
    const globalBlock = ["global", "global_weighted"];
    const globalCountry = "global";

    // Load i3e_countries.txt once
    fetch('i3e_countries.txt')
      .then(r => r.text())
      .then(text => {
        const parsed = parseTabFile(text);
        if (!parsed) return;

        // date = last date from index column (before dropping)
        // we saved dates already in parsed.dates
        if (parsed.dates && parsed.dates.length) time = parsed.dates[parsed.dates.length - 1];

        loadCountryTable(parsed);
      })
      .catch(err => console.error('Error loading i3e_countries.txt:', err));

    // Nav behavior
    document.querySelectorAll('.nav a').forEach(function(link) {
      link.addEventListener('click', function(event) {
        event.preventDefault();
        var contentDiv = document.getElementById('content');
        var tableDiv = document.getElementById('table-container');
        var tableSubDiv = document.getElementById('table-subindex-container');
        var linkText = this.textContent.trim();

        if (linkText === 'Home') {
          location.reload();
        } else if (linkText === 'Global Indices') {
          showContentAndResetLayout();
          contentDiv.innerHTML = `<h2 style="text-align: left;">I3E Global Indices</h2>`;
          tableDiv.style.display = 'none';
          tableSubDiv.style.display = 'none';
          document.querySelectorAll('.plot-container').forEach(div => div.style.display = 'none');
        } else if (linkText === 'Subindex') {
          hideContentForWideTable();
          tableDiv.style.display = 'none';
          tableSubDiv.style.display = 'block';
          document.querySelectorAll('.plot-container').forEach(div => div.style.display = 'none');
          loadSubindexTable();
        } else if (linkText === 'Data') {
          showContentAndResetLayout();
          contentDiv.innerHTML = `
            <p><a href="i3e_global.txt" target="_blank">DATA</a> - Download I3E global data (txt). Since 1990-01-01. Updated daily (${time}).</p>
            <p><a href="i3e_global_weighted.txt" target="_blank">DATA</a> - Download I3E global weighted data (txt). Since 1990-01-01. Updated daily (${time}).</p>
            <p><a href="i3e_countries.txt" target="_blank">DATA</a> - Download I3E country data (txt). Since 1990-01-01. Updated daily (${time}).</p>
            <p><a href="subindex.txt" target="_blank">DATA</a> - Download Subindex data (txt). Since 1990-01-01. Updated daily (${subindexTime || time}).</p>
          `;
          tableDiv.style.display = 'none';
          tableSubDiv.style.display = 'none';
          document.querySelectorAll('.plot-container').forEach(div => div.style.display = 'none');
        } else if (linkText === 'Research') {
          showContentAndResetLayout();
          contentDiv.innerHTML = `
            <h2>Research Papers</h2>
            <p><a href="I3E.pdf" target="_blank">Working paper</a> - I3E Technical Note.</p>
            <p><a href="I3E_and_alternatives.pdf" target="_blank">Working paper</a> - Comparison I3E, WUI, EPU and WIX.</p>
          `;
          tableDiv.style.display = 'none';
          tableSubDiv.style.display = 'none';
          document.querySelectorAll('.plot-container').forEach(div => div.style.display = 'none');
        } else if (linkText === 'Contact') {
          showContentAndResetLayout();
          contentDiv.innerHTML = `
            <p>
              Miguel Angel AriÃ±o <br>
              Professor, Managerial Decision Sciences <br>
              IESE Business School <br>
              <a href="https://www.iese.edu/es/claustro-investigacion/claustro/miguel-angel-arino/" target="_blank" style="color:#FF3B30;">Website</a><br>
              <br>
              Roberto Garcia-Castro <br>
              Professor, Managerial Decision Sciences <br>
              IESE Business School <br>
              <a href="https://www.iese.edu/es/claustro-investigacion/claustro/roberto-garcia-castro/" target="_blank" style="color:#FF3B30;">Website</a><br>
              <br>
              International Center for Decision Making (ICDM) <br>
              IESE Business School <br>
              <a href="https://www.iese.edu" target="_blank" style="color:#FF3B30;">Website</a><br>
            </p>
          `;
          tableDiv.style.display = 'none';
          tableSubDiv.style.display = 'none';
          document.querySelectorAll('.plot-container').forEach(div => div.style.display = 'none');
        } else {
          showContentAndResetLayout();
          contentDiv.innerHTML = "";
          tableDiv.style.display = 'none';
          tableSubDiv.style.display = 'none';
          document.querySelectorAll('.plot-container').forEach(div => div.style.display = 'none');
        }
      });
    });

    // -------- HOME TABLE --------
    function loadCountryTable(parsed) {
      const header = parsed.header; // excludes index col
      const rows = parsed.rows;     // excludes index col

      let lastIdx = rows.length - 1;
      let idx30 = rows.length - 22;
      let idx365 = rows.length - 261;

      // column map
      let col = {};
      header.forEach((name, i) => { col[String(name).trim().toLowerCase()] = i; });

      function get(rowIdx, key) {
        const j = col[String(key).trim().toLowerCase()];
        if (j === undefined) return "";
        if (rowIdx < 0 || rowIdx >= rows.length) return "";
        const v = rows[rowIdx][j];
        return (v === undefined || v === null) ? "" : String(v).trim();
      }

      let tableHTML = '';
      tableHTML += '<tr><th>Country</th><th>I3E</th><th>Î”1D</th><th>Î”1M</th><th>Î”1Y</th></tr>';

      countryBlocks.forEach((block) => {
        block.forEach((code, idxInBlock) => {
          const value = get(lastIdx, code);
          const prev  = get(lastIdx - 1, code);
          const v30   = get(idx30, code);
          const v365  = get(idx365, code);

          const isLastInBlock = (idxInBlock === block.length - 1);
          const tdStyle = isLastInBlock ? ' style="border-bottom: 2px solid #bbb;"' : '';

          tableHTML += `<tr>
            <td${tdStyle}>${formatCountryName(code)}</td>
            <td${tdStyle}>${value}</td>
            <td${tdStyle}>${diffSpan(value, prev, 1)}</td>
            <td${tdStyle}>${diffSpan(value, v30, 1)}</td>
            <td${tdStyle}>${diffSpan(value, v365, 1)}</td>
          </tr>`;
        });
      });

      globalBlock.forEach(code => {
        const value = get(lastIdx, code);
        const prev  = get(lastIdx - 1, code);
        const v30   = get(idx30, code);
        const v365  = get(idx365, code);

        tableHTML += `<tr style="font-weight: bold;">
          <td>${formatCountryName(code)}</td>
          <td>${value}</td>
          <td>${diffSpan(value, prev, 1)}</td>
          <td>${diffSpan(value, v30, 1)}</td>
          <td>${diffSpan(value, v365, 1)}</td>
        </tr>`;
      });

      let fullHTML = `<div style="font-size:14px; margin-bottom:10px;">Date: ${time}<br>I3E: last 1D: Î”1-day 1M: Î”1-month 1Y: Î”1-year</div><table>${tableHTML}</table>`;
      document.getElementById('table-container').innerHTML = fullHTML;
    }

    // -------- SUBINDEX TABLE --------
    function loadSubindexTable() {
      fetch('subindex.txt')
        .then(r => r.text())
        .then(text => {
          const parsed = parseTabFile(text);
          if (!parsed) return;

          subindexTime = (parsed.dates && parsed.dates.length) ? parsed.dates[parsed.dates.length - 1] : "";

          const header = parsed.header; // excludes index col
          const rows = parsed.rows;     // excludes index col

          let lastIdx = rows.length - 1;
          let idx30 = rows.length - 22;
          let idx365 = rows.length - 261;

          let col = {};
          header.forEach((name, i) => { col[String(name).trim().toLowerCase()] = i; });

          function get(rowIdx, key) {
            const j = col[String(key).trim().toLowerCase()];
            if (j === undefined) return "";
            if (rowIdx < 0 || rowIdx >= rows.length) return "";
            const v = rows[rowIdx][j];
            return (v === undefined || v === null) ? "" : String(v).trim();
          }

          // Brent series (column name in file: brent)
          const brentVal  = get(lastIdx, "brent");
          const brentPrev = get(lastIdx - 1, "brent");
          const brent30v  = get(idx30, "brent");
          const brent365v = get(idx365, "brent");

          let tableHTML = '';
          tableHTML += `<tr>
            <th>Country</th>
            <th>IDX</th><th>Î”1D</th><th>Î”1M</th><th>Î”1Y</th>
            <th>Bond</th><th>Î”1D</th><th>Î”1M</th><th>Î”1Y</th>
            <th>FX</th><th>Î”1D</th><th>Î”1M</th><th>Î”1Y</th>
            <th>Brent</th><th>Î”1D</th><th>Î”1M</th><th>Î”1Y</th>
          </tr>`;

          function addCountryRow(code, opts) {
            const bold = opts && opts.bold;
            const isLastInBlock = opts && opts.blockSeparator;

            const idxKey  = code + "_idx";
            const bondKey = code + "_bond";
            const fxKey   = code + "_fx";

            const idxVal   = get(lastIdx, idxKey);
            const idxPrev  = get(lastIdx - 1, idxKey);
            const idx30v   = get(idx30, idxKey);
            const idx365v  = get(idx365, idxKey);

            const bondVal  = get(lastIdx, bondKey);
            const bondPrev = get(lastIdx - 1, bondKey);
            const bond30v  = get(idx30, bondKey);
            const bond365v = get(idx365, bondKey);

            const fxVal    = get(lastIdx, fxKey);
            const fxPrev   = get(lastIdx - 1, fxKey);
            const fx30v    = get(idx30, fxKey);
            const fx365v   = get(idx365, fxKey);

            const rowStyle = bold ? ' style="font-weight:bold;"' : '';
            const tdStyle  = isLastInBlock ? ' style="border-bottom: 2px solid #bbb;"' : '';

            tableHTML += `<tr${rowStyle}>
              <td${tdStyle}>${formatCountryName(code)}</td>

              <td${tdStyle}>${idxVal}</td>
              <td${tdStyle}>${diffSpan(idxVal, idxPrev, 1)}</td>
              <td${tdStyle}>${diffSpan(idxVal, idx30v, 1)}</td>
              <td${tdStyle}>${diffSpan(idxVal, idx365v, 1)}</td>

              <td${tdStyle}>${bondVal}</td>
              <td${tdStyle}>${diffSpan(bondVal, bondPrev, 1)}</td>
              <td${tdStyle}>${diffSpan(bondVal, bond30v, 1)}</td>
              <td${tdStyle}>${diffSpan(bondVal, bond365v, 1)}</td>

              <td${tdStyle}>${fxVal}</td>
              <td${tdStyle}>${diffSpan(fxVal, fxPrev, 1)}</td>
              <td${tdStyle}>${diffSpan(fxVal, fx30v, 1)}</td>
              <td${tdStyle}>${diffSpan(fxVal, fx365v, 1)}</td>

              <td${tdStyle}>${brentVal}</td>
              <td${tdStyle}>${diffSpan(brentVal, brentPrev, 1)}</td>
              <td${tdStyle}>${diffSpan(brentVal, brent30v, 1)}</td>
              <td${tdStyle}>${diffSpan(brentVal, brent365v, 1)}</td>
            </tr>`;
          }

          countryBlocks.forEach((block) => {
            block.forEach((code, idxInBlock) => {
              addCountryRow(code, { blockSeparator: idxInBlock === block.length - 1 });
            });
          });

          // Global at end (bold)
          addCountryRow(globalCountry, { bold: true, blockSeparator: false });

          const headerInfo = `
            <div style="font-size:14px; margin-bottom:10px;">
              Date: ${subindexTime || time}<br>
              Values: last &nbsp;&nbsp; 1D: Î”1-day &nbsp;&nbsp; 1M: Î”1-month &nbsp;&nbsp; 1Y: Î”1-year
            </div>
          `;

          const footerText = `
            <div style="font-size:14px; margin-top:12px; max-width: 1200px;">
              <h2 style="margin: 6px 0 6px 0;">Subindex</h2>
              <p style="margin: 0;">
                This table reports the latest values and changes (Î”1D, Î”1M, Î”1Y) for the three subcomponents:
                <strong>Stock Index (idx)</strong>, <strong>10-year Bond Yield (bond)</strong>, and <strong>Exchange Rate (fx)</strong>.
                It also reports <strong>Brent</strong> (common to all countries).
              </p>
            </div>
          `;

          document.getElementById('table-subindex-container').innerHTML =
            `<div style="width:100%; overflow-x:auto;">${headerInfo}<table>${tableHTML}</table>${footerText}</div>`;
        })
        .catch(err => console.error('Error loading subindex.txt:', err));
    }
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      renderChart("chart-global", "global");
    });
  </script>

  <script>
    document.querySelectorAll('.sidebar a[data-country]').forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        const country = this.getAttribute('data-country');
        const containerId = `chart-${country}`;

        // Hide all charts
        document.querySelectorAll('.plot-container').forEach(div => div.style.display = 'none');

        // Hide tables
        const tableDiv = document.getElementById('table-container');
        const tableSubDiv = document.getElementById('table-subindex-container');
        if (tableDiv) tableDiv.style.display = 'none';
        if (tableSubDiv) tableSubDiv.style.display = 'none';

        // Restore content column
        showContentAndResetLayout();
        document.getElementById('content').innerHTML = "";

        const chartDiv = document.getElementById(containerId);
        if (chartDiv) {
          chartDiv.style.display = 'block';
          chartDiv.scrollIntoView({ behavior: 'smooth' });
          renderChart(containerId, country);

          if (window.Plotly) {
            setTimeout(() => {
              try { Plotly.Plots.resize(chartDiv); } catch(e) {}
            }, 0);
          }
        }
      });
    });
  </script>

  <script>
    function resizeAllPlots() {
      if (!window.Plotly) return;
      document.querySelectorAll('.plot-container').forEach(function (el) {
        try { Plotly.Plots.resize(el); } catch(e) {}
      });
    }

    window.addEventListener('resize', resizeAllPlots);
    window.addEventListener('orientationchange', function () {
      setTimeout(resizeAllPlots, 150);
    });
    window.addEventListener('load', function () {
      setTimeout(resizeAllPlots, 0);
    });
  </script>

</body>
</html>
